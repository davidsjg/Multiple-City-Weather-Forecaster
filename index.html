<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">    
    <link rel="stylesheet" href="style.css"/>
    <title>Weather Dashboard</title>
</head>

<header>
    <div class="jumbotron">
        <h1 class="mainDisp"></h1>
    </div>
</header>
<body>

<!-- Grid layout with rows and columns -->

<container class="main">
    <div class="row">
        <div class="col-3 searchColumn">
                <input type="text" class="inputValue" id="cityEntered">
                <input type="submit" value="Search" id="searchBtn">
                <div id="searchHistory"></div>
        </div>
        <div class="col-9" id="fullDisplay">
            <div class="row">
                <div class="card">
                    <div class="card-body">
                        <div class="row">
                            <div class="container" id="cityCurrent"></div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row">
                    <div class="row" id="fiveDayTitle"></div>
            </div>
            <div class="row">
                    <div class="row" id="fiveDay"></div>
            </div>
        </div>    
</div>






</body>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
<script type="text/javascript">
    $(document).ready(function(){
        $(".mainDisp").text("WEATHER DASHBOARD")
    })

    // loadLocalStorage ()

    $("#fullDisplay").hide()

    // ON CLICK EVENT carries out after search button is pressed  >>>>>>>>>> ON CLICK - SEARCH
    $("#searchBtn").on("click", function() {
        var cityName = $("#cityEntered").val()
        var inputVal = $(this).name
        console.log(this)









        // $("#fullDisplay").  HOW DO I CLEAR THAT DAMN DIV WHEN I CLICK SEARCH FOR SECOND TIME??
        $("#fullDisplay").show()

        var weatherKey = "0e06fc3239af5ded708f925cfeb73640"
        var queryURL = "https://api.openweathermap.org/data/2.5/weather?q=" + cityName + "&appid=" + weatherKey
        // makes promise and pulls weather API from openweathermap
        $.ajax({
            url: queryURL,
            method: "GET"
        }).then(function(response) {
            var results = response.data 
            var parentID = response.id
            localStorage.setItem(parentID, JSON.stringify(response))
            // creating searched city button dynamically ®
            addCityButton(response)
            getWeather(response)
        });

        // var queryURL2 = "api.openweathermap.org/data/2.5/forecast/daily?q=" + cityName + "&cnt=5&appid=" + weatherKey    

        var queryURL2 = "https://api.openweathermap.org/data/2.5/forecast/daily?q=Boston&cnt=5&appid=0e06fc3239af5ded708f925cfeb73640"
        $.ajax({
            url: queryURL2,
            method: "GET"
        }).then(function(resonse) {
            console.log(resonse)
            fillFivedayData(response)
        })
        })


    $("#searchHistory").on("click", function(){
        console.log(this)
        console.log("you are in serach history click")
        fillCityData(this)
        fillFivedayData(this)

        $.ajax({
            url: queryURL,
            method: "GET"
        }).then(function(response) {
            var results = response.data 
            // creating searched city button dynamically ®
            addCityButton(response)
            fillCityData(response)
            fillFivedayData(response)
        });


    })


function getWeather (currWeather) {
console.log(currWeather)
    var weatherKey = "0e06fc3239af5ded708f925cfeb73640"
        var cityName = $("#cityEntered").val()
        var queryURL = "https://api.openweathermap.org/data/2.5/weather?q=" + cityName + "&appid=" + weatherKey
        // makes promise and pulls weather API from openweathermap
        $.ajax({
            url: queryURL,
            method: "GET"
        }).then(function(currWeather) {
            var results = currWeather.data 
            // creating searched city button dynamically ®
            fillCityData(currWeather)
            fillFivedayData(currWeather)
        });

}


function addCityButton (cityEnt) {

    var cityButton = $("<button>").text(cityEnt.name).attr("class", "cityList")
    //adds button to search history
    $("#searchHistory").prepend(cityButton)
    console.log(cityEnt)


}


function fillCityData (fillData){

    console.log(fillData)

    var tempK = fillData.temp
    tempF = ((tempK - 273.15) * 1.8 +32).toFixed(0)

    var cityTitle = $("<h2>")
    cityTitle.text(fillData.name)
    $("#cityCurrent").append(cityTitle)
    //dynamically create temperature display current conditions
    var cityTemp = $("<h6>")
    cityTemp.text("Temperature: " + tempF + "F")
    $("#cityCurrent").append(cityTemp)
    //dynamically create humidity display current conditions
    var cityHumidity = $("<h6>")
    cityHumidity.text("Humidity: " + fillData.main.humidity + "%")
    $("#cityCurrent").append(cityHumidity)
    //dynamically create wind speed display current conditions
    var cityWindSpeed = $("<h6>")
    cityWindSpeed.text("Wind Speed: " + fillData.wind.speed + " MPH")
    $("#cityCurrent").append(cityWindSpeed)
    //dynamically create uv index display current conditions
    // var cityUVIndex = $("<h6>")
    // cityUVIndex.text("UV Index:")
    // $("#cityCurrent").append(cityUVIndex)

}

function fillFivedayData (response){


    //dynamically create 5 day title display 
    var day1 = $("<h2>")
    day1.text("5-Day Forecast")
    day1.attr("class", "day")
    $("#fiveDayTitle").append(day1)

    //dynamically create day 1 display forecast conditions
    var day1 = $("<container>")
    day1.attr("class", "day").attr("id", "day")
    $("#fiveDay").append(day1)

    //dynamically create day date for day 1
    var date1 = $("<div>").text("--date--").attr("class", "date")
    $("#day").append(date1)
    //dynamically create img for day 1
    var sky1 = $("<div>").text("--currentSky--").attr("class", "currentSky")
    $("#day").append(sky1)
    //dynamically create temp for day 1
    var temp1 = $("<div>").text("Temp:").attr("class", "currentTemp")
    $("#day").append(temp1)
    //dynamically create humidity for day 1
    var humidity1 = $("<div>").text("Humidity:").attr("class", "currentHum")
    $("#day").append(humidity1)


    //dynamically create day 2 display forecast conditions
    var day2 = $("<container>").text("ISSSS GON RAIN").attr("class", "day").attr("id", "day")
    $("#fiveDay").append(day2)
    //dynamically create day 3 display forecast conditions
    var day3 = $("<container>").text("ISS BLOWIN YALL").attr("class", "day").attr("id", "day")
    $("#fiveDay").append(day3)
    //dynamically create day 4 display forecast conditions
    var day4 = $("<container>").text("ISS BLOWIN YALL").attr("class", "day").attr("id", "day")
    $("#fiveDay").append(day4)
    //dynamically create day 5 display forecast conditions
    var day5 = $("<container>").text("ISS BLOWIN YALL").attr("class", "day").attr("id", "day")
    $("#fiveDay").append(day5)
}

    
</script>

</html>